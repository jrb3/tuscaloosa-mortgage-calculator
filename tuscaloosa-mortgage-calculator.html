<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuscaloosa County Mortgage Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .calculator-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input[type="number"]:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        .calculate-btn {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .calculate-btn:hover {
            background-color: #45a049;
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
        }
        
        .result-label {
            font-weight: bold;
            color: #333;
        }
        
        .result-value {
            color: #007bff;
            font-weight: bold;
        }
        
        .total-payment {
            border-top: 2px solid #4CAF50;
            padding-top: 10px;
            margin-top: 15px;
            font-size: 18px;
        }
        
        .info-box {
            background-color: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: #0c5460;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 600px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>Tuscaloosa County Mortgage Calculator</h1>
        
        <div class="info-box">
            <h3>Tuscaloosa County Tax Information</h3>
            <p>This calculator includes Tuscaloosa County's property tax rates. The average effective property tax rate is approximately <strong>0.33-0.46%</strong>, which is significantly lower than the national average of 1.02%.</p>
        </div>
        
        <form id="mortgageForm">
            <div class="two-column">
                <div class="form-group">
                    <label for="homePrice">Home Price ($)</label>
                    <input type="number" id="homePrice" value="148400" min="0" step="1000" required>
                </div>
                
                <div class="form-group">
                    <label for="downPayment">Down Payment ($)</label>
                    <input type="number" id="downPayment" value="29680" min="0" step="100" required>
                </div>
                
                <div class="form-group">
                    <label for="interestRate">Interest Rate (%)</label>
                    <input type="number" id="interestRate" value="6.5" min="0" max="30" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label for="loanTerm">Loan Term (years)</label>
                    <select id="loanTerm" required>
                        <option value="15">15 years</option>
                        <option value="20">20 years</option>
                        <option value="25">25 years</option>
                        <option value="30" selected>30 years</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="propertyTaxRate">Millage Rate (mills)</label>
                    <select id="propertyTaxRate" required>
                        <option value="33">33 mills - County Average</option>
                        <option value="46">46 mills - County Median</option>
                        <option value="53">53 mills - Tuscaloosa City</option>
                        <option value="custom">Custom Rate</option>
                    </select>
                </div>
                
                <div class="form-group" id="customTaxGroup" style="display: none;">
                    <label for="customTaxRate">Custom Millage Rate (mills)</label>
                    <input type="number" id="customTaxRate" min="0" max="200" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="homeInsurance">Home Insurance ($/year)</label>
                    <input type="number" id="homeInsurance" value="1200" min="0" step="50" required>
                </div>
                
                <div class="form-group">
                    <label for="pmi">PMI ($/month)</label>
                    <input type="number" id="pmi" value="0" min="0" step="10">
                </div>
                
                <div class="form-group">
                    <label for="hoaFees">HOA Fees ($/month)</label>
                    <input type="number" id="hoaFees" value="0" min="0" step="25">
                </div>
            </div>
            
            <button type="button" class="calculate-btn" onclick="calculateMortgage()">Calculate Mortgage Payment</button>
        </form>
        
        <div id="results" class="results" style="display: none;">
            <h3>Monthly Payment Breakdown</h3>
            <div class="result-item">
                <span class="result-label">Principal & Interest:</span>
                <span class="result-value" id="principalInterest">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Property Tax:</span>
                <span class="result-value" id="propertyTax">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Home Insurance:</span>
                <span class="result-value" id="insurance">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">PMI:</span>
                <span class="result-value" id="pmiAmount">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">HOA Fees:</span>
                <span class="result-value" id="hoaAmount">$0</span>
            </div>
            <div class="result-item total-payment">
                <span class="result-label">Total Monthly Payment:</span>
                <span class="result-value" id="totalPayment">$0</span>
            </div>
            
            <h3 style="margin-top: 20px;">Loan Summary</h3>
            <div class="result-item">
                <span class="result-label">Loan Amount:</span>
                <span class="result-value" id="loanAmount">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Down Payment:</span>
                <span class="result-value" id="downPaymentDisplay">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Total Interest Paid:</span>
                <span class="result-value" id="totalInterest">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Total Cost of Loan:</span>
                <span class="result-value" id="totalCost">$0</span>
            </div>
        </div>
    </div>

    <script>
        /**
         * Tuscaloosa County Mortgage Calculator
         * Encapsulated in IIFE to avoid global scope pollution
         */
        (function() {
            'use strict';

            // Constants
            const ALABAMA_ASSESSMENT_RATE = 0.10; // 10% for residential property
            const MILLS_TO_DECIMAL = 0.001;
            const PMI_THRESHOLD = 20; // LTV threshold percentage
            const DEFAULT_PMI_RATE = 0.005; // 0.5% annually

            /**
             * Validates mortgage input values
             * @param {number} homePrice - Home purchase price
             * @param {number} downPayment - Down payment amount
             * @returns {Object} Validation result with isValid and error message
             */
            function validateInputs(homePrice, downPayment) {
                if (isNaN(homePrice) || homePrice <= 0) {
                    return {
                        isValid: false,
                        error: 'Please enter a valid home price greater than $0.'
                    };
                }

                if (isNaN(downPayment) || downPayment < 0) {
                    return {
                        isValid: false,
                        error: 'Please enter a valid down payment amount.'
                    };
                }

                if (downPayment >= homePrice) {
                    return {
                        isValid: false,
                        error: 'Down payment must be less than the home price.'
                    };
                }

                return { isValid: true };
            }

            /**
             * Calculates monthly mortgage payment using standard amortization formula
             * @param {number} principal - Loan amount
             * @param {number} annualRate - Annual interest rate (as decimal, e.g., 0.065 for 6.5%)
             * @param {number} years - Loan term in years
             * @returns {number} Monthly principal and interest payment
             */
            function calculateMonthlyPayment(principal, annualRate, years) {
                try {
                    const monthlyRate = annualRate / 12;
                    const numPayments = years * 12;

                    // Handle zero interest rate case
                    if (monthlyRate === 0) {
                        return principal / numPayments;
                    }

                    // Standard amortization formula
                    const payment = principal *
                        (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
                        (Math.pow(1 + monthlyRate, numPayments) - 1);

                    return payment;
                } catch (error) {
                    console.error('Error calculating monthly payment:', error);
                    return 0;
                }
            }

            /**
             * Calculates Alabama property tax based on state assessment rules
             * @param {number} homeValue - Appraised home value
             * @param {number} millageRate - Local millage rate (in mills)
             * @returns {number} Annual property tax amount
             */
            function calculatePropertyTax(homeValue, millageRate) {
                try {
                    // Alabama uses 10% assessment rate for residential property
                    const assessedValue = homeValue * ALABAMA_ASSESSMENT_RATE;
                    // Convert millage rate to decimal (1 mill = $0.001 per $1 of assessed value)
                    const annualTax = assessedValue * (millageRate * MILLS_TO_DECIMAL);
                    return annualTax;
                } catch (error) {
                    console.error('Error calculating property tax:', error);
                    return 0;
                }
            }

            /**
             * Calculates estimated monthly PMI based on loan amount
             * @param {number} loanAmount - Total loan amount
             * @param {number} rate - Annual PMI rate (default 0.5%)
             * @returns {number} Monthly PMI payment
             */
            function calculatePMI(loanAmount, rate = DEFAULT_PMI_RATE) {
                try {
                    return Math.round((loanAmount * rate) / 12);
                } catch (error) {
                    console.error('Error calculating PMI:', error);
                    return 0;
                }
            }

            /**
             * Formats a number as currency string
             * @param {number} amount - Amount to format
             * @param {boolean} withCents - Include cents in output
             * @returns {string} Formatted currency string
             */
            function formatCurrency(amount, withCents = true) {
                try {
                    if (withCents) {
                        return '$' + amount.toFixed(2);
                    }
                    return '$' + amount.toLocaleString('en-US', {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    });
                } catch (error) {
                    console.error('Error formatting currency:', error);
                    return '$0.00';
                }
            }

            /**
             * Updates the display of calculation results
             * @param {Object} results - Calculation results object
             */
            function displayResults(results) {
                try {
                    // Monthly breakdown
                    document.getElementById('principalInterest').textContent =
                        formatCurrency(results.monthlyPI);
                    document.getElementById('propertyTax').textContent =
                        formatCurrency(results.monthlyPropertyTax);
                    document.getElementById('insurance').textContent =
                        formatCurrency(results.monthlyInsurance);
                    document.getElementById('pmiAmount').textContent =
                        formatCurrency(results.monthlyPMI);
                    document.getElementById('hoaAmount').textContent =
                        formatCurrency(results.monthlyHOA);
                    document.getElementById('totalPayment').textContent =
                        formatCurrency(results.totalMonthlyPayment);

                    // Loan summary
                    document.getElementById('loanAmount').textContent =
                        formatCurrency(results.loanAmount, false);
                    document.getElementById('downPaymentDisplay').textContent =
                        formatCurrency(results.downPayment, false);
                    document.getElementById('totalInterest').textContent =
                        formatCurrency(results.totalInterest, false);
                    document.getElementById('totalCost').textContent =
                        formatCurrency(results.totalCost, false);

                    // Show results section
                    const resultsElement = document.getElementById('results');
                    resultsElement.style.display = 'block';
                    resultsElement.scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('Error displaying results:', error);
                }
            }

            /**
             * Handles custom tax rate visibility based on selection
             */
            function handleTaxRateChange() {
                const taxRateSelect = document.getElementById('propertyTaxRate');
                const customGroup = document.getElementById('customTaxGroup');
                const customTaxInput = document.getElementById('customTaxRate');

                if (taxRateSelect.value === 'custom') {
                    customGroup.style.display = 'block';
                    customTaxInput.required = true;
                } else {
                    customGroup.style.display = 'none';
                    customTaxInput.required = false;
                }
            }

            /**
             * Auto-calculates and updates PMI based on down payment percentage
             */
            function handlePMICalculation() {
                try {
                    const homePrice = parseFloat(document.getElementById('homePrice').value) || 0;
                    const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;

                    if (homePrice <= 0) {
                        return;
                    }

                    const downPaymentPercent = (downPayment / homePrice) * 100;
                    const pmiInput = document.getElementById('pmi');

                    // PMI required when down payment < 20%
                    if (downPaymentPercent < PMI_THRESHOLD) {
                        const loanAmount = homePrice - downPayment;
                        const estimatedPMI = calculatePMI(loanAmount);
                        pmiInput.value = estimatedPMI;
                    } else {
                        pmiInput.value = 0;
                    }
                } catch (error) {
                    console.error('Error calculating PMI:', error);
                }
            }

            /**
             * Main mortgage calculation function
             * Computes all mortgage-related costs and displays results
             */
            function calculateMortgage() {
                try {
                    // Get input values
                    const homePrice = parseFloat(document.getElementById('homePrice').value) || 0;
                    const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
                    const annualRatePercent = parseFloat(document.getElementById('interestRate').value) || 0;
                    const loanTermYears = parseInt(document.getElementById('loanTerm').value) || 30;

                    // Get millage rate
                    const taxRateSelect = document.getElementById('propertyTaxRate').value;
                    const millageRate = taxRateSelect === 'custom'
                        ? parseFloat(document.getElementById('customTaxRate').value) || 0
                        : parseFloat(taxRateSelect) || 0;

                    const annualInsurance = parseFloat(document.getElementById('homeInsurance').value) || 0;
                    const monthlyPMI = parseFloat(document.getElementById('pmi').value) || 0;
                    const monthlyHOA = parseFloat(document.getElementById('hoaFees').value) || 0;

                    // Validate inputs
                    const validation = validateInputs(homePrice, downPayment);
                    if (!validation.isValid) {
                        alert(validation.error);
                        return;
                    }

                    // Calculate loan amount
                    const loanAmount = homePrice - downPayment;
                    const annualRate = annualRatePercent / 100;

                    // Calculate monthly principal & interest
                    const monthlyPI = calculateMonthlyPayment(loanAmount, annualRate, loanTermYears);

                    // Calculate monthly costs
                    const annualPropertyTax = calculatePropertyTax(homePrice, millageRate);
                    const monthlyPropertyTax = annualPropertyTax / 12;
                    const monthlyInsurance = annualInsurance / 12;

                    // Calculate total monthly payment
                    const totalMonthlyPayment = monthlyPI + monthlyPropertyTax +
                                               monthlyInsurance + monthlyPMI + monthlyHOA;

                    // Calculate total costs over life of loan
                    const numPayments = loanTermYears * 12;
                    const totalPrincipalInterest = monthlyPI * numPayments;
                    const totalInterest = totalPrincipalInterest - loanAmount;
                    const totalCost = homePrice + totalInterest +
                                     (annualInsurance * loanTermYears) +
                                     (monthlyPMI * numPayments) +
                                     (monthlyHOA * numPayments);

                    // Display results
                    displayResults({
                        monthlyPI,
                        monthlyPropertyTax,
                        monthlyInsurance,
                        monthlyPMI,
                        monthlyHOA,
                        totalMonthlyPayment,
                        loanAmount,
                        downPayment,
                        totalInterest,
                        totalCost
                    });
                } catch (error) {
                    console.error('Error in mortgage calculation:', error);
                    alert('An error occurred while calculating. Please check your inputs and try again.');
                }
            }

            /**
             * Initialize event listeners and default calculations
             */
            function init() {
                // Tax rate selector
                document.getElementById('propertyTaxRate')
                    .addEventListener('change', handleTaxRateChange);

                // PMI auto-calculation
                document.getElementById('downPayment')
                    .addEventListener('input', handlePMICalculation);

                document.getElementById('homePrice')
                    .addEventListener('input', handlePMICalculation);

                // Calculate on page load with default values
                calculateMortgage();
            }

            // Expose calculateMortgage to global scope for form button
            window.calculateMortgage = calculateMortgage;

            // Initialize on page load
            window.addEventListener('load', init);
        })();
    </script>
</body>
</html>